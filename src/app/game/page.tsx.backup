'use client';

import { useState, useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { motion } from 'framer-motion';
import { Gamepad2, Trophy, Star, ArrowLeft, Check } from 'lucide-react';
import Image from 'next/image';
import CuteButton from '@/components/common/button/CuteButton';
import CuteCard from '@/components/common/card/CuteCard';
import Alert from '@/components/common/alert/Alert';
import GameRulesModal from '@/components/game/GameRulesModal';
import { useUserStore } from '@/libs/store/user/userStore';
import { findMyPet } from '@/libs/api/pet/petApi';
import { MyPetResponse } from '@/libs/interface/api/pet/petResponseInterface';
import { getMyWeeklyScore, getWeeklyRankings } from '@/libs/api/game/gameApi';
import { MyWeeklyScoreResponseDto, RankingItemDto } from '@/libs/interface/api/game/gameInterface';
import Link from 'next/link';
import AdSense from '@/components/common/adsense/AdSense';

export default function GamePage() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { user } = useUserStore();
  const [selectedPetImage, setSelectedPetImage] = useState<string>('default');
  const [selectedPetId, setSelectedPetId] = useState<number | null>(null);
  const [finalScore, setFinalScore] = useState<number>(0);
  const [showResult, setShowResult] = useState(false);
  const [myPets, setMyPets] = useState<MyPetResponse[]>([]);
  const [isLoadingPets, setIsLoadingPets] = useState(false);
  const [myWeeklyScore, setMyWeeklyScore] = useState<MyWeeklyScoreResponseDto | null>(null);
  const [weeklyRankings, setWeeklyRankings] = useState<RankingItemDto[]>([]);
  const [isLoadingScore, setIsLoadingScore] = useState(false);
  const [isLoadingRankings, setIsLoadingRankings] = useState(false);
  const [alertMessage, setAlertMessage] = useState('');
  const [needsLogin, setNeedsLogin] = useState(false);
  const [showRulesModal, setShowRulesModal] = useState(false);
  const adsenseId = process.env.NEXT_PUBLIC_ADSENSE_ID || '';

  // ë¡œê·¸ì¸ ì²´í¬
  useEffect(() => {
    const accessToken = localStorage.getItem('a_t');
    if (!accessToken) {
      setAlertMessage('ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.');
      setNeedsLogin(true);
    }
  }, []);

  // URLì—ì„œ ì ìˆ˜ íŒŒë¼ë¯¸í„° í™•ì¸
  useEffect(() => {
    const score = searchParams.get('score');
    if (score) {
      setFinalScore(parseInt(score, 10));
      setShowResult(true);
      // URLì—ì„œ score íŒŒë¼ë¯¸í„° ì œê±°
      router.replace('/game');
    }
  }, [searchParams]);

  useEffect(() => {
    // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ë°ì´í„° ë¡œë“œ
    if (user) {
      loadMyPets();
      loadMyWeeklyScore();
    }
    // ì£¼ê°„ ë­í‚¹ì€ í•­ìƒ ë¡œë“œ
    loadWeeklyRankings();
  }, [user]);

  const loadMyPets = async () => {
    setIsLoadingPets(true);
    try {
      const response = await findMyPet();
      if (response.resultCode === 200 && response.result && response.result.pets) {
        // ë””ë²„ê¹…: í« ë°ì´í„° í™•ì¸
        console.log('ğŸ“¸ í« ë°ì´í„°:', response.result.pets);
        response.result.pets.forEach((pet, index) => {
          console.log(`í« ${index + 1}:`, {
            name: pet.name,
            petId: pet.petId,
            imageUrl: pet.imageUrl,
          });
        });

        setMyPets(response.result.pets);
        // ì²« ë²ˆì§¸ í«ì„ ê¸°ë³¸ ì„ íƒ
        if (response.result.pets.length > 0) {
          setSelectedPetImage(response.result.pets[0].imageUrl || 'default');
          setSelectedPetId(response.result.pets[0].petId);
        }
      }
    } catch (error) {
      setMyPets([]);
    } finally {
      setIsLoadingPets(false);
    }
  };

  const loadMyWeeklyScore = async () => {
    setIsLoadingScore(true);
    try {
      const response = await getMyWeeklyScore();
      if (response.resultCode === 200 && response.result) {
        setMyWeeklyScore(response.result);
      }
    } catch (error) {
      setMyWeeklyScore(null);
    } finally {
      setIsLoadingScore(false);
    }
  };

  const loadWeeklyRankings = async () => {
    setIsLoadingRankings(true);
    try {
      const response = await getWeeklyRankings();
      if (response.resultCode === 200 && response.result && response.result.rankings) {
        setWeeklyRankings(response.result.rankings);
      }
    } catch (error) {
      setWeeklyRankings([]);
    } finally {
      setIsLoadingRankings(false);
    }
  };

  const handleStartGame = () => {
    const imageUrl = selectedPetImage && selectedPetImage !== '' ? selectedPetImage : 'default';
    // ê²Œì„ í”Œë ˆì´ í˜ì´ì§€ë¡œ ì´ë™
    router.push(`/game/play?petImage=${encodeURIComponent(imageUrl)}`);
  };

  const handleRestart = () => {
    setShowResult(false);
    handleStartGame();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50/50 via-pink-50/50 to-white py-8 px-4">
      {/* ë¡œê·¸ì¸ í•„ìš” ì•Œë¦¼ */}
      {needsLogin && (
        <Alert
          message={alertMessage}
          onClose={() => {
            setAlertMessage('');
            setNeedsLogin(false);
            router.push('/login');
          }}
        />
      )}

      <div className="max-w-4xl mx-auto">
        {/* ë’¤ë¡œê°€ê¸° */}
        <div className="mb-6">
          <Link
            href="/"
            className="inline-flex items-center text-purple-600 hover:text-purple-800 transition-colors duration-200"
          >
            <ArrowLeft className="w-5 h-5 mr-2" />
            í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
          </Link>
        </div>

        {/* AdSense - ìƒë‹¨ */}
        {adsenseId && (
          <div className="mb-6">
            <AdSense
              adClient={adsenseId}
              adFormat="auto"
              adSlot=""
              fullWidthResponsive={true}
            />
          </div>
        )}

        {/* ê²Œì„ ê²°ê³¼ ëª¨ë‹¬ */}
        {showResult && (
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="mb-8"
          >
            <CuteCard padding="lg" className="bg-gradient-to-r from-yellow-50 to-orange-50 border-4 border-yellow-400">
              <div className="text-center space-y-4">
                <Trophy className="w-16 h-16 text-yellow-500 mx-auto" />
                <h2 className="text-3xl font-bold text-gray-900">ê²Œì„ ì¢…ë£Œ!</h2>
                <p className="text-5xl font-bold text-purple-600">{finalScore}ì´ˆ</p>
                <p className="text-gray-600">
                  {user ? 'ë­í‚¹ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ë¡œê·¸ì¸í•˜ë©´ ë­í‚¹ì— ë“±ë¡í•  ìˆ˜ ìˆì–´ìš”!'}
                </p>
                <div className="flex gap-4 justify-center">
                  <CuteButton variant="primary" onClick={handleRestart}>
                    ë‹¤ì‹œ ë„ì „í•˜ê¸°
                  </CuteButton>
                  <CuteButton variant="secondary" onClick={() => router.push('/game/ranking')}>
                    ë­í‚¹ ë³´ê¸°
                  </CuteButton>
                </div>
              </div>
            </CuteCard>
          </motion.div>
        )}

        {/* í—¤ë” */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="text-center mb-8"
        >
          <div className="flex items-center justify-center space-x-3 mb-4">
            <Gamepad2 className="w-10 h-10 text-purple-500" />
            <h1 className="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
              í« í¬ë¼ìš´ í”¼í•˜ê¸°
            </h1>
            <Gamepad2 className="w-10 h-10 text-pink-500" />
          </div>
          <p className="text-gray-600 text-lg">
            ê·€ì—¬ìš´ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ ì¥ì• ë¬¼ì„ í”¼í•´ë³´ì„¸ìš”! ğŸ¾
          </p>
        </motion.div>

        {/* ë‚´ ì£¼ê°„ ì ìˆ˜ & ì£¼ê°„ ë­í‚¹ */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
          {/* ë‚´ ì£¼ê°„ ì ìˆ˜ */}
          {user && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.6, delay: 0.1 }}
            >
              <CuteCard padding="lg" className="h-full">
                <h2 className="text-xl font-bold text-gray-900 mb-4 flex items-center space-x-2">
                  <Trophy className="w-5 h-5 text-yellow-500" />
                  <span>ë‚´ ì£¼ê°„ ìµœê³  ì ìˆ˜</span>
                </h2>
                {isLoadingScore ? (
                  <div className="flex justify-center py-8">
                    <div className="animate-spin rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"></div>
                  </div>
                ) : myWeeklyScore ? (
                  <div className="space-y-4">
                    <div className="flex items-center space-x-4">
                      {myWeeklyScore.imageUrl && (
                        <div className="relative w-16 h-16 rounded-full overflow-hidden flex-shrink-0 border-4 border-purple-300">
                          <Image
                            src={myWeeklyScore.imageUrl}
                            alt="ë‚´ ìºë¦­í„°"
                            fill
                            className="object-cover"
                            unoptimized
                          />
                        </div>
                      )}
                      <div className="flex-1">
                        <p className="text-3xl font-bold text-purple-600">{myWeeklyScore.score.toFixed(1)}ì´ˆ</p>
                        <p className="text-sm text-gray-500">ì£¼ ì‹œì‘: {myWeeklyScore.weekStartDate}</p>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-6 text-gray-500">
                    <p>ì•„ì§ ì´ë²ˆ ì£¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p className="text-sm mt-2">ê²Œì„ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                  </div>
                )}
              </CuteCard>
            </motion.div>
          )}

          {/* ì£¼ê°„ ë­í‚¹ TOP 3 */}
          <motion.div
            initial={{ opacity: 0, x: 20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.6, delay: 0.15 }}
            className={user ? '' : 'lg:col-span-2'}
          >
            <CuteCard padding="lg" className="h-full">
              <h2 className="text-xl font-bold text-gray-900 mb-4 flex items-center space-x-2">
                <Star className="w-5 h-5 text-yellow-500" fill="currentColor" />
                <span>ì£¼ê°„ ë­í‚¹ TOP 3</span>
              </h2>
              {isLoadingRankings ? (
                <div className="flex justify-center py-8">
                  <div className="animate-spin rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"></div>
                </div>
              ) : weeklyRankings.length > 0 ? (
                <div className="space-y-3">
                  {weeklyRankings.slice(0, 3).map((rank) => (
                    <div
                      key={rank.userId}
                      className={`flex items-center space-x-3 p-3 rounded-xl ${
                        rank.ranking === 1
                          ? 'bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-400'
                          : rank.ranking === 2
                          ? 'bg-gradient-to-r from-gray-100 to-gray-200 border-2 border-gray-400'
                          : 'bg-gradient-to-r from-orange-50 to-orange-100 border-2 border-orange-300'
                      }`}
                    >
                      <div className="text-2xl font-bold min-w-[32px] text-center">
                        {rank.ranking === 1 ? 'ğŸ¥‡' : rank.ranking === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}
                      </div>
                      {rank.imageUrl && (
                        <div className="relative w-12 h-12 rounded-full overflow-hidden flex-shrink-0 border-2 border-white">
                          <Image
                            src={rank.imageUrl}
                            alt={rank.nickname}
                            fill
                            className="object-cover"
                            unoptimized
                          />
                        </div>
                      )}
                      <div className="flex-1 min-w-0">
                        <p className="font-semibold text-gray-900 truncate">{rank.nickname}</p>
                        <p className="text-sm text-gray-600">{rank.score.toFixed(1)}ì´ˆ</p>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-6 text-gray-500">
                  <p>ì•„ì§ ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                  <p className="text-sm mt-2">ì²« ë²ˆì§¸ ë­ì»¤ê°€ ë˜ì–´ë³´ì„¸ìš”!</p>
                </div>
              )}
            </CuteCard>
          </motion.div>
        </div>

        {/* ê²Œì„ ì„¤ëª… */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6, delay: 0.2 }}
          className="mb-8"
        >
          <CuteCard padding="lg">
            <h2 className="text-2xl font-bold text-gray-900 mb-4 flex items-center space-x-2">
              <Star className="w-6 h-6 text-yellow-500" fill="currentColor" />
              <span>ê²Œì„ ë°©ë²•</span>
            </h2>
            <div className="space-y-3 text-gray-700">
              <p className="flex items-start space-x-2">
                <span className="font-bold text-purple-600 min-w-[24px]">1.</span>
                <span>ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ì¥ì• ë¬¼ì„ í”¼í•˜ì„¸ìš”!</span>
              </p>
              <p className="flex items-start space-x-2">
                <span className="font-bold text-purple-600 min-w-[24px]">2.</span>
                <span><strong>ëª¨ë°”ì¼:</strong> í™”ë©´ì„ í„°ì¹˜í•˜ê±°ë‚˜ ë“œë˜ê·¸í•´ì„œ ì¢Œìš°ë¡œ ì´ë™</span>
              </p>
              <p className="flex items-start space-x-2">
                <span className="font-bold text-purple-600 min-w-[24px]">3.</span>
                <span><strong>ë°ìŠ¤í¬í†±:</strong> í™”ì‚´í‘œ í‚¤(â† â†’) ë˜ëŠ” A/D í‚¤ë¡œ ì´ë™</span>
              </p>
              <p className="flex items-start space-x-2">
                <span className="font-bold text-purple-600 min-w-[24px]">4.</span>
                <span className="text-red-600 font-semibold">ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‚œì´ë„ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤!</span>
              </p>
              <p className="flex items-start space-x-2">
                <span className="font-bold text-purple-600 min-w-[24px]">5.</span>
                <span>ìµœëŒ€í•œ ì˜¤ë˜ ë²„í‹°ê³  ë­í‚¹ì— ë„ì „í•˜ì„¸ìš”! ğŸ†</span>
              </p>
            </div>
          </CuteCard>
        </motion.div>

        {/* ìºë¦­í„° ì„ íƒ */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6, delay: 0.3 }}
          className="mb-8"
        >
          <CuteCard padding="lg">
            <h2 className="text-2xl font-bold text-gray-900 mb-4 text-center">
              {user ? 'ìºë¦­í„° ì„ íƒ' : 'ìºë¦­í„°'}
            </h2>

            {user ? (
              isLoadingPets ? (
                <div className="flex justify-center py-8">
                  <div className="animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
                </div>
              ) : myPets.length > 0 ? (
                <div>
                  <p className="text-gray-600 mb-6 text-center">
                    ë‚´ ë°˜ë ¤ë™ë¬¼ì„ ì„ íƒí•˜ì—¬ ê²Œì„ì— ì°¸ì—¬í•˜ì„¸ìš”! ğŸ¾
                  </p>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {/* ê¸°ë³¸ ìºë¦­í„° */}
                    <button
                      onClick={() => {
                        setSelectedPetImage('default');
                        setSelectedPetId(null);
                      }}
                      className={`relative rounded-2xl p-4 transition-all duration-200 ${
                        selectedPetImage === 'default' && selectedPetId === null
                          ? 'bg-gradient-to-br from-purple-100 to-pink-100 border-4 border-purple-500 shadow-lg'
                          : 'bg-gray-50 border-2 border-gray-200 hover:border-purple-300'
                      }`}
                    >
                      <div className="aspect-square rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mb-2 relative overflow-hidden border-2 border-gray-300">
                        {/* ê°•ì•„ì§€ ì‹¤ë£¨ì—£ */}
                        <svg className="w-12 h-12 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M18 6c.55 0 1 .45 1 1v1c0 1.1-.9 2-2 2h-.75v1.5c0 1.4-1.1 2.5-2.5 2.5S11.25 13 11.25 11.5v-.75h-1.5v.75c0 1.4-1.1 2.5-2.5 2.5S4.75 13 4.75 11.5V10H4c-1.1 0-2-.9-2-2V7c0-.55.45-1 1-1s1 .45 1 1v1h1V7c0-1.1.9-2 2-2h.5C7.5 3.9 8.4 3 9.5 3S11.5 3.9 11.5 5h1C12.5 3.9 13.4 3 14.5 3s2 .9 2 2h.5c1.1 0 2 .9 2 2v1h1V7c0-.55.45-1 1-1zM7 13c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1zm5 0c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1zm5 0c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1z"/>
                        </svg>
                      </div>
                      <p className="text-center font-semibold text-sm">ê¸°ë³¸ ìºë¦­í„°</p>
                      {selectedPetImage === 'default' && selectedPetId === null && (
                        <div className="absolute top-2 right-2 bg-purple-500 rounded-full p-1">
                          <Check className="w-4 h-4 text-white" />
                        </div>
                      )}
                    </button>

                    {/* ì‚¬ìš©ìì˜ í«ë“¤ */}
                    {myPets.map((pet) => {
                      return (
                        <button
                          key={pet.petId}
                          onClick={() => {
                            setSelectedPetImage(pet.imageUrl || 'default');
                            setSelectedPetId(pet.petId);
                          }}
                          className={`relative rounded-2xl p-4 transition-all duration-200 ${
                            selectedPetId === pet.petId
                              ? 'bg-gradient-to-br from-purple-100 to-pink-100 border-4 border-purple-500 shadow-lg'
                              : 'bg-gray-50 border-2 border-gray-200 hover:border-purple-300'
                          }`}
                        >
                          <div className="aspect-square rounded-xl overflow-hidden mb-2 relative">
                            {pet.imageUrl ? (
                              <Image
                                src={pet.imageUrl}
                                alt={pet.name}
                                fill
                                className="object-cover"
                                unoptimized
                              />
                            ) : (
                              <div className="w-full h-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center">
                                <span className="text-4xl">ğŸ¾</span>
                              </div>
                            )}
                          </div>
                          <p className="text-center font-semibold text-sm truncate">{pet.name}</p>
                          {selectedPetId === pet.petId && (
                            <div className="absolute top-2 right-2 bg-purple-500 rounded-full p-1">
                              <Check className="w-4 h-4 text-white" />
                            </div>
                          )}
                        </button>
                      );
                    })}
                  </div>
                </div>
              ) : (
                <div className="text-center py-6">
                  <p className="text-gray-600 mb-4">
                    ë“±ë¡ëœ ë°˜ë ¤ë™ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br />
                    ê¸°ë³¸ ìºë¦­í„°ë¡œ í”Œë ˆì´í•˜ì„¸ìš”!
                  </p>
                  <div className="flex justify-center">
                    <div className="relative">
                      <div className="w-32 h-32 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shadow-xl border-4 border-gray-300">
                        {/* ê°•ì•„ì§€ ì‹¤ë£¨ì—£ */}
                        <svg className="w-20 h-20 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M18 6c.55 0 1 .45 1 1v1c0 1.1-.9 2-2 2h-.75v1.5c0 1.4-1.1 2.5-2.5 2.5S11.25 13 11.25 11.5v-.75h-1.5v.75c0 1.4-1.1 2.5-2.5 2.5S4.75 13 4.75 11.5V10H4c-1.1 0-2-.9-2-2V7c0-.55.45-1 1-1s1 .45 1 1v1h1V7c0-1.1.9-2 2-2h.5C7.5 3.9 8.4 3 9.5 3S11.5 3.9 11.5 5h1C12.5 3.9 13.4 3 14.5 3s2 .9 2 2h.5c1.1 0 2 .9 2 2v1h1V7c0-.55.45-1 1-1zM7 13c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1zm5 0c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1zm5 0c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1z"/>
                        </svg>
                      </div>
                      <div className="absolute -bottom-2 -right-2 bg-yellow-400 rounded-full p-2 shadow-lg">
                        <Star className="w-6 h-6 text-white" fill="currentColor" />
                      </div>
                    </div>
                  </div>
                </div>
              )
            ) : (
              <div className="text-center">
                <p className="text-gray-600 mb-6">
                  ë¡œê·¸ì¸í•˜ë©´ ë‚´ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ í”Œë ˆì´í•  ìˆ˜ ìˆì–´ìš”!<br />
                  ì§€ê¸ˆì€ ê¸°ë³¸ ìºë¦­í„°ë¡œ í”Œë ˆì´í•˜ì„¸ìš”!
                </p>
                <div className="flex justify-center">
                  <div className="relative">
                    <div className="w-32 h-32 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shadow-xl border-4 border-gray-300">
                      {/* ê°•ì•„ì§€ ì‹¤ë£¨ì—£ */}
                      <svg className="w-20 h-20 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18 6c.55 0 1 .45 1 1v1c0 1.1-.9 2-2 2h-.75v1.5c0 1.4-1.1 2.5-2.5 2.5S11.25 13 11.25 11.5v-.75h-1.5v.75c0 1.4-1.1 2.5-2.5 2.5S4.75 13 4.75 11.5V10H4c-1.1 0-2-.9-2-2V7c0-.55.45-1 1-1s1 .45 1 1v1h1V7c0-1.1.9-2 2-2h.5C7.5 3.9 8.4 3 9.5 3S11.5 3.9 11.5 5h1C12.5 3.9 13.4 3 14.5 3s2 .9 2 2h.5c1.1 0 2 .9 2 2v1h1V7c0-.55.45-1 1-1zM7 13c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1zm5 0c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1zm5 0c.55 0 1 .45 1 1v5c0 .55-.45 1-1 1s-1-.45-1-1v-5c0-.55.45-1 1-1z"/>
                      </svg>
                    </div>
                    <div className="absolute -bottom-2 -right-2 bg-yellow-400 rounded-full p-2 shadow-lg">
                      <Star className="w-6 h-6 text-white" fill="currentColor" />
                    </div>
                  </div>
                </div>
              </div>
            )}
          </CuteCard>
        </motion.div>

        {/* ì‹œì‘ ë²„íŠ¼ */}
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.5, delay: 0.4 }}
          className="flex flex-col items-center gap-4"
        >
          <div className="flex flex-col md:flex-row items-center gap-3 md:gap-4 w-full md:w-auto">
            <CuteButton
              variant="primary"
              size="xl"
              onClick={handleStartGame}
              className="shadow-2xl w-full md:w-auto"
            >
              ê²Œì„ ì‹œì‘í•˜ê¸°
            </CuteButton>

            <CuteButton
              variant="secondary"
              size="xl"
              onClick={() => setShowRulesModal(true)}
              className="w-full md:w-auto"
            >
              ê²Œì„ ê·œì¹™
            </CuteButton>
          </div>

          <button
            className="inline-flex items-center space-x-2 text-purple-600 hover:text-purple-800 transition-colors duration-200"
            onClick={() => router.push('/game/ranking')}
          >
            <Trophy className="w-5 h-5" />
            <span>ê²Œì„ ë­í‚¹ ë³´ê¸°</span>
          </button>
        </motion.div>

        {/* ê²Œì„ ê·œì¹™ ëª¨ë‹¬ */}
        <GameRulesModal
          isOpen={showRulesModal}
          onClose={() => setShowRulesModal(false)}
          onStart={handleStartGame}
        />
      </div>
    </div>
  );
}
